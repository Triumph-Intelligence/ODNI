<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Portal - Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #6366f1;
            --primary-hover: #4f46e5;
            --primary-light: #a5b4fc;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --success-light: #d1fae5;
            --warning-color: #f59e0b;
            --warning-light: #fef3c7;
            --error-color: #ef4444;
            --error-light: #fee2e2;
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-elevated: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --gradient-warning: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            --radius-sm: 6px;
            --radius: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .app-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 72px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            display: flex;
            align-items: center;
            padding: 0 32px;
            z-index: 100;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.05), 0 1px 2px -1px rgb(0 0 0 / 0.05);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .header-controls {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .org-switcher {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.7);
            padding: 8px 16px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        .org-switcher label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .org-switcher select {
            padding: 6px 12px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            background: white;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .org-switcher select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(226, 232, 240, 0.6);
            padding-top: 72px;
            height: 100vh;
            overflow-y: auto;
        }

        .nav-menu {
            padding: 24px 16px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 20px;
            margin-bottom: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: var(--radius-lg);
            font-weight: 500;
            font-size: 15px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }

        .nav-item:hover,
        .nav-item:focus {
            background: rgba(99, 102, 241, 0.08);
            color: var(--primary-color);
            outline: none;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .nav-item.active::before {
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding-top: 72px;
            overflow-y: auto;
            background: transparent;
        }

        .page {
            display: none;
            padding: 32px;
            animation: fadeIn 0.3s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 32px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin-bottom: 32px;
        }

        /* KPI Cards */
        .kpi-card {
            text-align: center;
            position: relative;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
        }

        .kpi-card::after {
            content: '';
            position: absolute;
            top: 16px;
            right: 16px;
            width: 8px;
            height: 8px;
            background: var(--success-color);
            border-radius: 50%;
            opacity: 0.6;
        }

        .kpi-value {
            font-size: 40px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -0.025em;
        }

        .kpi-label {
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .clickable {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .clickable:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover,
        .btn:focus {
            background: rgba(255, 255, 255, 1);
            outline: none;
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
            border-color: var(--primary-light);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border-color: transparent;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover,
        .btn-primary:focus {
            background: var(--primary-hover);
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: 13px;
            border-radius: var(--radius);
        }

        /* Tables */
        .table-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .table-container:hover {
            box-shadow: var(--shadow-xl);
            border-color: rgba(99, 102, 241, 0.2);
        }

        .table-header {
            padding: 24px 32px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
        }

        .table-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            width: 280px;
            padding: 10px 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: linear-gradient(135deg, rgba(248, 250, 252, 0.9) 0%, rgba(241, 245, 249, 0.9) 100%);
            padding: 16px 20px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            border-bottom: 2px solid rgba(226, 232, 240, 0.6);
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
            font-size: 14px;
            letter-spacing: 0.025em;
            text-transform: uppercase;
            transition: all 0.2s ease;
        }

        .table th:hover {
            background: linear-gradient(135deg, rgba(241, 245, 249, 0.9) 0%, rgba(226, 232, 240, 0.9) 100%);
            color: var(--primary-color);
        }

        .table td {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(226, 232, 240, 0.4);
            vertical-align: middle;
            font-size: 14px;
            font-weight: 500;
        }

        .table tr {
            transition: all 0.2s ease;
        }

        .table tr:hover {
            background: rgba(99, 102, 241, 0.04);
            transform: scale(1.001);
        }

        .table-empty {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-muted);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: var(--radius-lg);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: var(--shadow-sm);
        }

        .badge-covered {
            background: var(--success-light);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .badge-needs-intro {
            background: var(--warning-light);
            color: var(--warning-color);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .badge-unserved {
            background: var(--error-light);
            color: var(--error-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Overdue highlighting */
        .overdue {
            background-color: #fef2f2 !important;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 1100;
        }

        .toast {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-lg);
            min-width: 300px;
            transform: translateX(100%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--error-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .card-grid {
                grid-template-columns: 1fr;
            }
            
            .table-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>CRM Portal</h1>
            <div class="header-controls">
                <div class="org-switcher">
                    <label for="org-select">Organization:</label>
                    <select id="org-select" onchange="switchOrganization(this.value)">
                        <option value="Triumph Atlantic">Triumph Atlantic</option>
                        <option value="Guercio Energy Group">Guercio Energy Group</option>
                        <option value="Myers Industrial Services">Myers Industrial Services</option>
                        <option value="KMP">KMP</option>
                        <option value="Stable Works">Stable Works</option>
                        <option value="Red Door">Red Door</option>
                        <option value="Fritz Staffing">Fritz Staffing</option>
                        <option value="Byers">Byers</option>
                    </select>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-menu">
                <button class="nav-item active" onclick="showPage('dashboard')">Dashboard</button>
                <button class="nav-item" onclick="showPage('intelligence')">Office of National Intelligence</button>
                <button class="nav-item" onclick="showPage('companies')">Companies</button>
                <button class="nav-item" onclick="showPage('contacts')">Contacts & Gifts</button>
                <button class="nav-item" onclick="showPage('referrals')">Referrals</button>
                <button class="nav-item" onclick="showPage('opportunities')">Opportunities</button>
                <button class="nav-item" onclick="showPage('projects')">Projects</button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="page-header">
                    <h2 class="page-title">Dashboard</h2>
                </div>

                <div class="card-grid">
                    <div class="card kpi-card clickable" onclick="showPage('contacts')">
                        <div class="kpi-value" id="overdue-touches">8</div>
                        <div class="kpi-label">Overdue Touches</div>
                    </div>
                    <div class="card kpi-card clickable">
                        <div class="kpi-value" id="last-gift">5</div>
                        <div class="kpi-label">Days Since Last Gift</div>
                    </div>
                    <div class="card kpi-card clickable">
                        <div class="kpi-value" id="referrals-asked">12</div>
                        <div class="kpi-label">Referrals Asked (30d)</div>
                    </div>
                    <div class="card kpi-card clickable">
                        <div class="kpi-value" id="open-opps">$485K</div>
                        <div class="kpi-label">Open Opps (Weighted)</div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Recent Activity</h3>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-activity"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Intelligence Page -->
            <div id="intelligence" class="page">
                <div class="page-header">
                    <h2 class="page-title">Office of National Intelligence</h2>
                    <p style="color: var(--text-secondary); margin-top: 8px;">Comprehensive intelligence on companies, contacts, and business relationships</p>
                </div>

                <div class="card">
                    <h3 class="card-title">Intelligence Summary</h3>
                    <div class="card-grid">
                        <div style="padding: 16px; background: var(--background); border-radius: var(--radius); border: 1px solid var(--border);">
                            <div style="font-size: 32px; font-weight: 700; color: var(--primary-color);" id="intel-companies">0</div>
                            <div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Companies Tracked</div>
                        </div>
                        <div style="padding: 16px; background: var(--background); border-radius: var(--radius); border: 1px solid var(--border);">
                            <div style="font-size: 32px; font-weight: 700; color: var(--primary-color);" id="intel-locations">0</div>
                            <div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Total Locations</div>
                        </div>
                        <div style="padding: 16px; background: var(--background); border-radius: var(--radius); border: 1px solid var(--border);">
                            <div style="font-size: 32px; font-weight: 700; color: var(--primary-color);" id="intel-contacts">0</div>
                            <div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Total Contacts</div>
                        </div>
                        <div style="padding: 16px; background: var(--background); border-radius: var(--radius); border: 1px solid var(--border);">
                            <div style="font-size: 32px; font-weight: 700; color: var(--warning-color);" id="intel-unserved">0</div>
                            <div style="color: var(--text-secondary); font-size: 14px; margin-top: 4px;">Unserved Locations</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Contractor Intelligence Matrix</h3>
                    <p style="margin-bottom: 16px; color: var(--text-secondary);">Who serves which companies across all service lines</p>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Electrical</th>
                                    <th>Mechanical</th>
                                    <th>Interior GC</th>
                                    <th>Marketing</th>
                                    <th>Staffing</th>
                                </tr>
                            </thead>
                            <tbody id="intel-matrix-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Location Intelligence</h3>
                    <p style="margin-bottom: 16px; color: var(--text-secondary);">All company locations with contact coverage status</p>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Location</th>
                                    <th>City/State</th>
                                    <th>Contacts</th>
                                    <th>Last Contacted</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="intel-locations-body"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Recent Changes & Activity Log</h3>
                    <div class="table-wrapper" style="max-height: 400px;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>User</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="change-log-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Companies Page -->
            <div id="companies" class="page">
                <div class="page-header">
                    <h2 class="page-title">Companies</h2>
                </div>

                <div class="table-container">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Company Name</th>
                                    <th>Tier</th>
                                    <th>Status</th>
                                    <th>HQ State</th>
                                    <th>Locations</th>
                                    <th>Contacts</th>
                                </tr>
                            </thead>
                            <tbody id="companies-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Contacts Page -->
            <div id="contacts" class="page">
                <div class="page-header">
                    <h2 class="page-title">Contacts & Gifts</h2>
                </div>

                <div class="table-container">
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Title</th>
                                    <th>Company</th>
                                    <th>Location</th>
                                    <th>Channel</th>
                                    <th>Last Contacted</th>
                                    <th>Next Touch Due</th>
                                    <th>Last Gift</th>
                                </tr>
                            </thead>
                            <tbody id="contacts-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Referrals Page -->
            <div id="referrals" class="page">
                <div class="page-header">
                    <h2 class="page-title">Referrals</h2>
                </div>
                <div class="card">
                    <h3 class="card-title">Active Referrals</h3>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Referred Person</th>
                                    <th>Company</th>
                                    <th>Referred By</th>
                                    <th>Follow-up Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="referrals-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Opportunities Page -->
            <div id="opportunities" class="page">
                <div class="page-header">
                    <h2 class="page-title">Opportunities</h2>
                </div>

                <div class="card">
                    <h3 class="card-title">Active Opportunities</h3>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Location</th>
                                    <th>Job Description</th>
                                    <th>Contact</th>
                                    <th>Start Date</th>
                                    <th>Valuation</th>
                                </tr>
                            </thead>
                            <tbody id="opportunities-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Projects Page -->
            <div id="projects" class="page">
                <div class="page-header">
                    <h2 class="page-title">Projects</h2>
                </div>

                <div class="card">
                    <h3 class="card-title">Active Projects</h3>
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Location</th>
                                    <th>Job Description</th>
                                    <th>Contact</th>
                                    <th>Start Date</th>
                                    <th>End Date</th>
                                    <th>Valuation</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // Mock Data Generator
        const mockData = {
            companies: [
                { name: 'PepsiCo', normalized: 'pepsico', tier: 'Enterprise', status: 'Active', hq_state: 'NY', 
                  contractors: { electrical: 'Guercio Energy Group', mechanical: 'Myers Industrial Services', interior_gc: 'KMP', marketing: 'Red Door', staffing: 'Fritz Staffing' }},
                { name: 'Coca-Cola Company', normalized: 'coca-cola', tier: 'Enterprise', status: 'Active', hq_state: 'GA',
                  contractors: { electrical: 'Guercio Energy Group', mechanical: '', interior_gc: 'Stable Works', marketing: 'Red Door', staffing: '' }},
                { name: 'Mondelez International', normalized: 'mondelez', tier: 'Enterprise', status: 'Active', hq_state: 'IL',
                  contractors: { electrical: '', mechanical: 'Myers Industrial Services', interior_gc: 'KMP', marketing: '', staffing: 'Byers' }},
                { name: 'Nestl√© USA', normalized: 'nestle-usa', tier: 'Large', status: 'Prospect', hq_state: 'CA',
                  contractors: { electrical: '', mechanical: 'Myers Industrial Services', interior_gc: '', marketing: '', staffing: 'Byers' }},
                { name: 'General Mills', normalized: 'general-mills', tier: 'Large', status: 'Active', hq_state: 'MN',
                  contractors: { electrical: '', mechanical: '', interior_gc: 'KMP', marketing: 'Red Door', staffing: 'Fritz Staffing' }},
                { name: 'Kellogg Company', normalized: 'kellogg', tier: 'Large', status: 'Active', hq_state: 'MI',
                  contractors: { electrical: 'Guercio Energy Group', mechanical: 'Myers Industrial Services', interior_gc: 'Stable Works', marketing: '', staffing: '' }},
                { name: 'Mars Inc', normalized: 'mars', tier: 'Enterprise', status: 'Prospect', hq_state: 'VA',
                  contractors: { electrical: '', mechanical: '', interior_gc: 'KMP', marketing: 'Red Door', staffing: 'Fritz Staffing' }},
                { name: 'Kraft Heinz', normalized: 'kraft-heinz', tier: 'Enterprise', status: 'Active', hq_state: 'IL',
                  contractors: { electrical: 'Guercio Energy Group', mechanical: 'Myers Industrial Services', interior_gc: 'Stable Works', marketing: '', staffing: 'Byers' }},
                { name: 'Conagra Brands', normalized: 'conagra', tier: 'Large', status: 'Active', hq_state: 'IL',
                  contractors: { electrical: '', mechanical: '', interior_gc: 'KMP', marketing: 'Red Door', staffing: '' }},
                { name: 'Campbell Soup', normalized: 'campbell', tier: 'Mid', status: 'Prospect', hq_state: 'NJ',
                  contractors: { electrical: 'Guercio Energy Group', mechanical: '', interior_gc: '', marketing: '', staffing: 'Fritz Staffing' }}
            ],
            
            locations: [
                // PepsiCo
                { company: 'pepsico', name: 'Purchase HQ', city: 'Purchase', state: 'NY', zip: '10577' },
                { company: 'pepsico', name: 'Newark Bottling', city: 'Newark', state: 'NJ', zip: '07102' },
                { company: 'pepsico', name: 'Chicago Distribution', city: 'Chicago', state: 'IL', zip: '60601' },
                { company: 'pepsico', name: 'Dallas Plant', city: 'Dallas', state: 'TX', zip: '75201' },
                { company: 'pepsico', name: 'Phoenix Facility', city: 'Phoenix', state: 'AZ', zip: '85001' },
                // Coca-Cola
                { company: 'coca-cola', name: 'Atlanta HQ', city: 'Atlanta', state: 'GA', zip: '30313' },
                { company: 'coca-cola', name: 'Miami Distribution', city: 'Miami', state: 'FL', zip: '33101' },
                { company: 'coca-cola', name: 'Houston Bottling', city: 'Houston', state: 'TX', zip: '77001' },
                { company: 'coca-cola', name: 'Seattle Facility', city: 'Seattle', state: 'WA', zip: '98101' },
                // Mondelez
                { company: 'mondelez', name: 'Chicago HQ', city: 'Chicago', state: 'IL', zip: '60601' },
                { company: 'mondelez', name: 'Philadelphia Plant', city: 'Philadelphia', state: 'PA', zip: '19019' },
                { company: 'mondelez', name: 'Portland Facility', city: 'Portland', state: 'OR', zip: '97201' },
                // Nestle
                { company: 'nestle-usa', name: 'Glendale HQ', city: 'Glendale', state: 'CA', zip: '91203' },
                { company: 'nestle-usa', name: 'San Francisco Office', city: 'San Francisco', state: 'CA', zip: '94102' },
                { company: 'nestle-usa', name: 'Denver Distribution', city: 'Denver', state: 'CO', zip: '80201' },
                // General Mills
                { company: 'general-mills', name: 'Minneapolis HQ', city: 'Minneapolis', state: 'MN', zip: '55426' },
                { company: 'general-mills', name: 'Buffalo Plant', city: 'Buffalo', state: 'NY', zip: '14201' },
                { company: 'general-mills', name: 'Kansas City Facility', city: 'Kansas City', state: 'MO', zip: '64101' },
                // Kellogg
                { company: 'kellogg', name: 'Battle Creek HQ', city: 'Battle Creek', state: 'MI', zip: '49017' },
                { company: 'kellogg', name: 'Memphis Plant', city: 'Memphis', state: 'TN', zip: '38101' },
                { company: 'kellogg', name: 'Omaha Facility', city: 'Omaha', state: 'NE', zip: '68101' },
                // Mars
                { company: 'mars', name: 'McLean HQ', city: 'McLean', state: 'VA', zip: '22101' },
                { company: 'mars', name: 'Hackettstown Plant', city: 'Hackettstown', state: 'NJ', zip: '07840' },
                { company: 'mars', name: 'Waco Facility', city: 'Waco', state: 'TX', zip: '76701' },
                // Kraft Heinz
                { company: 'kraft-heinz', name: 'Chicago HQ', city: 'Chicago', state: 'IL', zip: '60604' },
                { company: 'kraft-heinz', name: 'Pittsburgh Office', city: 'Pittsburgh', state: 'PA', zip: '15201' },
                { company: 'kraft-heinz', name: 'Ontario Plant', city: 'Ontario', state: 'CA', zip: '91761' },
                // Conagra
                { company: 'conagra', name: 'Chicago HQ', city: 'Chicago', state: 'IL', zip: '60654' },
                { company: 'conagra', name: 'Omaha Office', city: 'Omaha', state: 'NE', zip: '68102' },
                { company: 'conagra', name: 'Milton PA Plant', city: 'Milton', state: 'PA', zip: '17847' },
                // Campbell
                { company: 'campbell', name: 'Camden HQ', city: 'Camden', state: 'NJ', zip: '08103' },
                { company: 'campbell', name: 'Charlotte Plant', city: 'Charlotte', state: 'NC', zip: '28201' },
                { company: 'campbell', name: 'Sacramento Facility', city: 'Sacramento', state: 'CA', zip: '95814' }
            ],
            
            contacts: [
                // PepsiCo contacts
                { first: 'John', last: 'Smith', email: 'john.smith@pepsico.com', phone: '555-0101', title: 'VP Operations', company: 'pepsico', location: 'Purchase HQ', last_contacted: '2024-12-20', channel: 'email', cadence: 30, last_gift: '2024-11-15' },
                { first: 'Sarah', last: 'Johnson', email: 'sarah.johnson@pepsico.com', phone: '555-0102', title: 'Plant Manager', company: 'pepsico', location: 'Newark Bottling', last_contacted: '2024-11-25', channel: 'phone', cadence: 45, last_gift: '' },
                { first: 'Michael', last: 'Chen', email: 'michael.chen@pepsico.com', phone: '555-0103', title: 'Distribution Director', company: 'pepsico', location: 'Chicago Distribution', last_contacted: '2024-10-15', channel: 'email', cadence: 30, last_gift: '2024-09-20' },
                { first: 'Emily', last: 'Rodriguez', email: 'emily.r@pepsico.com', phone: '555-0104', title: 'Facilities Manager', company: 'pepsico', location: 'Dallas Plant', last_contacted: '', channel: 'linkedin', cadence: 60, last_gift: '' },
                
                // Coca-Cola contacts
                { first: 'David', last: 'Williams', email: 'dwilliams@coca-cola.com', phone: '555-0201', title: 'SVP Operations', company: 'coca-cola', location: 'Atlanta HQ', last_contacted: '2024-12-18', channel: 'email', cadence: 30, last_gift: '2024-12-10' },
                { first: 'Jennifer', last: 'Taylor', email: 'jen.taylor@coca-cola.com', phone: '555-0202', title: 'Regional Manager', company: 'coca-cola', location: 'Miami Distribution', last_contacted: '2024-12-15', channel: 'phone', cadence: 30, last_gift: '2024-11-22' },
                { first: 'Robert', last: 'Brown', email: 'rbrown@coca-cola.com', phone: '555-0203', title: 'Operations Manager', company: 'coca-cola', location: 'Houston Bottling', last_contacted: '2024-11-10', channel: 'email', cadence: 60, last_gift: '' },
                
                // Mondelez contacts
                { first: 'Lisa', last: 'Anderson', email: 'lisa.anderson@mondelez.com', phone: '555-0301', title: 'VP Facilities', company: 'mondelez', location: 'Chicago HQ', last_contacted: '2024-12-05', channel: 'email', cadence: 45, last_gift: '2024-10-30' },
                { first: 'James', last: 'Martinez', email: 'james.m@mondelez.com', phone: '555-0302', title: 'Plant Director', company: 'mondelez', location: 'Philadelphia Plant', last_contacted: '2024-11-20', channel: 'phone', cadence: 30, last_gift: '' },
                { first: 'Patricia', last: 'Wilson', email: 'pwilson@mondelez.com', phone: '555-0303', title: 'Maintenance Manager', company: 'mondelez', location: 'Portland Facility', last_contacted: '', channel: 'email', cadence: 90, last_gift: '' },
                
                // Nestle contacts
                { first: 'Thomas', last: 'Garcia', email: 'thomas.garcia@nestle.com', phone: '555-0401', title: 'Director Operations', company: 'nestle-usa', location: 'Glendale HQ', last_contacted: '2024-12-08', channel: 'email', cadence: 60, last_gift: '' },
                { first: 'Nancy', last: 'Lee', email: 'nancy.lee@nestle.com', phone: '555-0402', title: 'Facilities Coordinator', company: 'nestle-usa', location: 'San Francisco Office', last_contacted: '2024-10-20', channel: 'linkedin', cadence: 90, last_gift: '' },
                
                // General Mills contacts
                { first: 'Christopher', last: 'Moore', email: 'chris.moore@genmills.com', phone: '555-0501', title: 'VP Engineering', company: 'general-mills', location: 'Minneapolis HQ', last_contacted: '2024-12-12', channel: 'email', cadence: 30, last_gift: '2024-12-05' },
                { first: 'Amanda', last: 'Davis', email: 'amanda.davis@genmills.com', phone: '555-0502', title: 'Plant Manager', company: 'general-mills', location: 'Buffalo Plant', last_contacted: '2024-11-28', channel: 'phone', cadence: 45, last_gift: '' },
                { first: 'Daniel', last: 'Thompson', email: 'dthompson@genmills.com', phone: '555-0503', title: 'Operations Lead', company: 'general-mills', location: 'Kansas City Facility', last_contacted: '2024-10-05', channel: 'email', cadence: 30, last_gift: '' },
                
                // Kellogg contacts
                { first: 'Michelle', last: 'White', email: 'michelle.white@kellogg.com', phone: '555-0601', title: 'Director Facilities', company: 'kellogg', location: 'Battle Creek HQ', last_contacted: '2024-12-10', channel: 'email', cadence: 30, last_gift: '' },
                { first: 'Kevin', last: 'Harris', email: 'kevin.harris@kellogg.com', phone: '555-0602', title: 'Plant Supervisor', company: 'kellogg', location: 'Memphis Plant', last_contacted: '2024-11-15', channel: 'phone', cadence: 60, last_gift: '2024-10-25' },
                
                // Mars contacts
                { first: 'Jessica', last: 'Clark', email: 'jessica.clark@mars.com', phone: '555-0701', title: 'VP Operations', company: 'mars', location: 'McLean HQ', last_contacted: '2024-12-01', channel: 'email', cadence: 45, last_gift: '' },
                { first: 'Brian', last: 'Lewis', email: 'brian.lewis@mars.com', phone: '555-0702', title: 'Site Manager', company: 'mars', location: 'Hackettstown Plant', last_contacted: '', channel: 'phone', cadence: 60, last_gift: '' },
                
                // Kraft Heinz contacts
                { first: 'Rachel', last: 'Walker', email: 'rachel.walker@kraftheinz.com', phone: '555-0801', title: 'SVP Manufacturing', company: 'kraft-heinz', location: 'Chicago HQ', last_contacted: '2024-12-14', channel: 'email', cadence: 30, last_gift: '2024-11-30' },
                { first: 'Steven', last: 'Hall', email: 'steven.hall@kraftheinz.com', phone: '555-0802', title: 'Regional Director', company: 'kraft-heinz', location: 'Pittsburgh Office', last_contacted: '2024-11-22', channel: 'phone', cadence: 45, last_gift: '' },
                
                // Conagra contacts
                { first: 'Laura', last: 'Young', email: 'laura.young@conagra.com', phone: '555-0901', title: 'Operations Director', company: 'conagra', location: 'Chicago HQ', last_contacted: '2024-12-03', channel: 'email', cadence: 60, last_gift: '' },
                { first: 'Jason', last: 'Allen', email: 'jason.allen@conagra.com', phone: '555-0902', title: 'Plant Manager', company: 'conagra', location: 'Milton PA Plant', last_contacted: '2024-10-18', channel: 'phone', cadence: 30, last_gift: '' },
                
                // Campbell contacts
                { first: 'Angela', last: 'King', email: 'angela.king@campbells.com', phone: '555-1001', title: 'Director Engineering', company: 'campbell', location: 'Camden HQ', last_contacted: '2024-11-05', channel: 'email', cadence: 90, last_gift: '' },
                { first: 'Timothy', last: 'Wright', email: 'timothy.wright@campbells.com', phone: '555-1002', title: 'Facilities Manager', company: 'campbell', location: 'Charlotte Plant', last_contacted: '', channel: 'linkedin', cadence: 60, last_gift: '' }
            ],
            
            gifts: [
                { contact_email: 'john.smith@pepsico.com', description: 'Starbucks Gift Card', value: 50.00, date: '2024-11-15' },
                { contact_email: 'michael.chen@pepsico.com', description: 'Holiday Gift Basket', value: 75.00, date: '2024-09-20' },
                { contact_email: 'dwilliams@coca-cola.com', description: 'Restaurant Gift Card', value: 100.00, date: '2024-12-10' },
                { contact_email: 'jen.taylor@coca-cola.com', description: 'Wine & Cheese Basket', value: 85.00, date: '2024-11-22' },
                { contact_email: 'lisa.anderson@mondelez.com', description: 'Amazon Gift Card', value: 50.00, date: '2024-10-30' },
                { contact_email: 'chris.moore@genmills.com', description: 'Coffee Subscription', value: 60.00, date: '2024-12-05' },
                { contact_email: 'kevin.harris@kellogg.com', description: 'Sports Tickets', value: 150.00, date: '2024-10-25' },
                { contact_email: 'rachel.walker@kraftheinz.com', description: 'Spa Gift Certificate', value: 120.00, date: '2024-11-30' }
            ],
            
            referrals: [
                { referred_name: 'Mark Patterson', company: 'Frito-Lay', referrer_email: 'john.smith@pepsico.com', followup_date: '2024-12-30', status: 'Pending' },
                { referred_name: 'Susan Chen', company: 'Minute Maid', referrer_email: 'dwilliams@coca-cola.com', followup_date: '2024-12-28', status: 'Pending' },
                { referred_name: 'Robert Kim', company: 'Cadbury', referrer_email: 'lisa.anderson@mondelez.com', followup_date: '2025-01-05', status: 'Contacted' },
                { referred_name: 'Maria Gonzalez', company: 'Purina', referrer_email: 'thomas.garcia@nestle.com', followup_date: '2024-12-25', status: 'Meeting Scheduled' },
                { referred_name: 'Andrew Foster', company: 'Pillsbury', referrer_email: 'chris.moore@genmills.com', followup_date: '2025-01-10', status: 'Pending' },
                { referred_name: 'Nicole Sanders', company: 'Pringles', referrer_email: 'michelle.white@kellogg.com', followup_date: '2024-12-22', status: 'Closed-Won' },
                { referred_name: 'Peter Brooks', company: 'M&Ms', referrer_email: 'jessica.clark@mars.com', followup_date: '2025-01-08', status: 'Pending' },
                { referred_name: 'Christine Lee', company: 'Oscar Mayer', referrer_email: 'rachel.walker@kraftheinz.com', followup_date: '2024-12-27', status: 'Contacted' },
                { referred_name: 'Gregory Hall', company: 'Birds Eye', referrer_email: 'laura.young@conagra.com', followup_date: '2025-01-15', status: 'Pending' },
                { referred_name: 'Samantha Price', company: 'Pepperidge Farm', referrer_email: 'angela.king@campbells.com', followup_date: '2025-01-12', status: 'Pending' },
                { referred_name: 'William Torres', company: 'Tropicana', referrer_email: 'sarah.johnson@pepsico.com', followup_date: '2024-12-29', status: 'Contacted' },
                { referred_name: 'Diana Murphy', company: 'Sprite Bottling', referrer_email: 'jen.taylor@coca-cola.com', followup_date: '2025-01-03', status: 'Pending' }
            ],
            
            opportunities: [
                { company: 'PepsiCo', location: 'Dallas Plant', job: 'Electrical System Upgrade', contact: 'Emily Rodriguez', start: '2025-02-01', valuation: '$125,000' },
                { company: 'Coca-Cola Company', location: 'Seattle Facility', job: 'HVAC Replacement', contact: 'New Contact', start: '2025-01-15', valuation: '$85,000' },
                { company: 'Mondelez International', location: 'Portland Facility', job: 'Interior Renovation', contact: 'Patricia Wilson', start: '2025-03-01', valuation: '$200,000' },
                { company: 'Kellogg Company', location: 'Omaha Facility', job: 'Electrical & Mechanical Upgrades', contact: 'New Contact', start: '2025-02-15', valuation: '$150,000' },
                { company: 'Mars Inc', location: 'Waco Facility', job: 'Complete Facility Modernization', contact: 'New Contact', start: '2025-04-01', valuation: '$350,000' }
            ],
            
            projects: [
                { company: 'PepsiCo', location: 'Chicago Distribution', job: 'Warehouse Lighting Upgrade', contact: 'Michael Chen', start: '2024-11-01', end: '2025-01-15', valuation: '$95,000' },
                { company: 'Coca-Cola Company', location: 'Atlanta HQ', job: 'Office Renovation - Floor 3', contact: 'David Williams', start: '2024-12-01', end: '2025-02-28', valuation: '$180,000' },
                { company: 'General Mills', location: 'Buffalo Plant', job: 'Production Line Electrical', contact: 'Amanda Davis', start: '2024-10-15', end: '2025-01-30', valuation: '$220,000' },
                { company: 'Kraft Heinz', location: 'Chicago HQ', job: 'Building Automation System', contact: 'Rachel Walker', start: '2024-11-15', end: '2025-03-01', valuation: '$165,000' }
            ],
            
            changeLog: [
                { timestamp: '2024-12-15T10:30:00', user: 'John Doe', org: 'Triumph Atlantic', action: 'Contractor Assignment', details: 'PepsiCo: Assigned Guercio Energy Group as electrical contractor' },
                { timestamp: '2024-12-15T09:15:00', user: 'Jane Smith', org: 'Red Door', action: 'Contact Added', details: 'Added Jennifer Taylor (jen.taylor@coca-cola.com) at Coca-Cola' },
                { timestamp: '2024-12-14T16:45:00', user: 'Mike Johnson', org: 'Myers Industrial Services', action: 'Activity Logged', details: 'Phone call with Lisa Anderson on 2024-12-14' },
                { timestamp: '2024-12-14T14:20:00', user: 'Sarah Williams', org: 'Triumph Atlantic', action: 'Gift Added', details: 'Restaurant Gift Card ($100.00) for David Williams' },
                { timestamp: '2024-12-13T11:30:00', user: 'John Doe', org: 'KMP', action: 'Contractor Assignment', details: 'Mondelez: Assigned KMP as interior GC' },
                { timestamp: '2024-12-13T10:00:00', user: 'Jane Smith', org: 'Fritz Staffing', action: 'Contact Updated', details: 'Updated Christopher Moore last contact date to 2024-12-12' },
                { timestamp: '2024-12-12T15:30:00', user: 'Mike Johnson', org: 'Guercio Energy Group', action: 'Opportunity Created', details: 'New opportunity: PepsiCo Dallas Plant - $125K' },
                { timestamp: '2024-12-12T09:45:00', user: 'Sarah Williams', org: 'Triumph Atlantic', action: 'Location Imported', details: 'Kellogg: 3 locations added' },
                { timestamp: '2024-12-11T16:15:00', user: 'John Doe', org: 'Stable Works', action: 'Contact Added', details: 'Added Michelle White (michelle.white@kellogg.com)' },
                { timestamp: '2024-12-11T13:20:00', user: 'Jane Smith', org: 'Myers Industrial Services', action: 'Activity Logged', details: 'Meeting with Thomas Garcia on 2024-12-08' }
            ]
        };

        // Global state
        let currentOrg = 'Triumph Atlantic';
        let currentPage = 'dashboard';

        // Utility functions
        function formatDate(dateStr) {
            if (!dateStr) return '‚Äî';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function calculateNextTouchDue(lastContacted, cadenceDays) {
            if (!lastContacted) return '';
            const lastDate = new Date(lastContacted);
            const nextDate = new Date(lastDate.getTime() + (cadenceDays * 24 * 60 * 60 * 1000));
            return nextDate.toISOString().split('T')[0];
        }

        function isOverdue(nextTouchDue) {
            if (!nextTouchDue) return false;
            const today = new Date().toISOString().split('T')[0];
            return nextTouchDue < today;
        }

        function companyVisibleToOrg(company, org) {
            if (org === 'Triumph Atlantic') return true;
            
            const contractors = company.contractors || {};
            const orgLower = org.toLowerCase();
            return Object.values(contractors).some(contractor => 
                contractor && contractor.toLowerCase() === orgLower
            );
        }

        function computeUnservedLocations(companyNorm, days = 90) {
            const companyLocations = mockData.locations.filter(l => l.company === companyNorm);
            const companyContacts = mockData.contacts.filter(c => c.company === companyNorm);
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);

            return companyLocations.map(location => {
                const locationContacts = companyContacts.filter(c => c.location === location.name);
                
                if (locationContacts.length === 0) {
                    return { ...location, contacts: [], contact: '‚Äî', last_contacted: '‚Äî', status: 'Unserved' };
                }

                const recentContact = locationContacts.find(c => 
                    c.last_contacted && new Date(c.last_contacted) > cutoffDate
                );

                const contactList = locationContacts.map(c => `${c.first} ${c.last}`).join(', ');

                if (recentContact) {
                    return { ...location, contacts: locationContacts, contact: contactList, 
                            last_contacted: formatDate(recentContact.last_contacted), status: 'Covered' };
                } else {
                    const oldestContact = locationContacts.sort((a, b) => 
                        (b.last_contacted || '0000-00-00').localeCompare(a.last_contacted || '0000-00-00')
                    )[0];
                    
                    return { ...location, contacts: locationContacts, contact: contactList,
                            last_contacted: formatDate(oldestContact.last_contacted) || '‚Äî', status: 'Needs Intro' };
                }
            });
        }

        // Organization switcher
        function switchOrganization(org) {
            currentOrg = org;
            showToast(`Switched to ${org}`, 'success');
            updateAllViews();
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            
            currentPage = pageId;
            updatePageContent(pageId);
        }

        // Update all views
        function updateAllViews() {
            updatePageContent(currentPage);
        }

        function updatePageContent(pageId) {
            switch(pageId) {
                case 'dashboard':
                    updateDashboard();
                    break;
                case 'intelligence':
                    updateIntelligence();
                    break;
                case 'companies':
                    updateCompanies();
                    break;
                case 'contacts':
                    updateContacts();
                    break;
                case 'referrals':
                    updateReferrals();
                    break;
                case 'opportunities':
                    updateOpportunities();
                    break;
                case 'projects':
                    updateProjects();
                    break;
            }
        }

        // Dashboard
        function updateDashboard() {
            const visibleCompanies = mockData.companies.filter(c => companyVisibleToOrg(c, currentOrg));
            const visibleContacts = mockData.contacts.filter(contact => {
                const company = mockData.companies.find(c => c.normalized === contact.company);
                return company && companyVisibleToOrg(company, currentOrg);
            });

            // Calculate overdue touches
            const today = new Date().toISOString().split('T')[0];
            const overdueCount = visibleContacts.filter(contact => {
                const nextDue = calculateNextTouchDue(contact.last_contacted, contact.cadence);
                return nextDue && nextDue < today;
            }).length;
            document.getElementById('overdue-touches').textContent = overdueCount;

            // Days since last gift
            const visibleGifts = mockData.gifts.filter(gift => {
                return visibleContacts.some(c => c.email === gift.contact_email);
            });
            if (visibleGifts.length > 0) {
                const mostRecentGift = visibleGifts.sort((a, b) => b.date.localeCompare(a.date))[0];
                const daysSince = Math.floor((new Date() - new Date(mostRecentGift.date)) / (1000 * 60 * 60 * 24));
                document.getElementById('last-gift').textContent = daysSince;
            }

            // Referrals asked
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentReferrals = mockData.referrals.filter(ref => {
                const contact = visibleContacts.find(c => c.email === ref.referrer_email);
                return contact && new Date(ref.followup_date) >= thirtyDaysAgo;
            }).length;
            document.getElementById('referrals-asked').textContent = recentReferrals;

            // Open opportunities
            const visibleOpps = mockData.opportunities.filter(opp => {
                const company = visibleCompanies.find(c => c.name === opp.company);
                return company !== undefined;
            });
            const totalValue = visibleOpps.reduce((sum, opp) => {
                const value = parseFloat(opp.valuation.replace(/[^0-9.-]/g, ''));
                return sum + value;
            }, 0);
            document.getElementById('open-opps').textContent = `$${Math.round(totalValue / 1000)}K`;

            // Recent activity
            const activityHtml = mockData.changeLog.slice(0, 10).map(log => {
                const date = new Date(log.timestamp);
                return `
                    <tr>
                        <td>${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                        <td><strong>${log.action}</strong></td>
                        <td>${log.details}</td>
                    </tr>
                `;
            }).join('');
            document.getElementById('dashboard-activity').innerHTML = activityHtml || '<tr><td colspan="3" class="table-empty">No recent activity</td></tr>';
        }

        // Intelligence
        function updateIntelligence() {
            const visibleCompanies = mockData.companies.filter(c => companyVisibleToOrg(c, currentOrg));
            
            const totalLocations = mockData.locations.filter(l => {
                const company = mockData.companies.find(c => c.normalized === l.company);
                return company && companyVisibleToOrg(company, currentOrg);
            }).length;
            
            const visibleContacts = mockData.contacts.filter(contact => {
                const company = mockData.companies.find(c => c.normalized === contact.company);
                return company && companyVisibleToOrg(company, currentOrg);
            }).length;
            
            let totalUnserved = 0;
            visibleCompanies.forEach(company => {
                const unserved = computeUnservedLocations(company.normalized).filter(l => l.status === 'Unserved');
                totalUnserved += unserved.length;
            });
            
            document.getElementById('intel-companies').textContent = visibleCompanies.length;
            document.getElementById('intel-locations').textContent = totalLocations;
            document.getElementById('intel-contacts').textContent = visibleContacts;
            document.getElementById('intel-unserved').textContent = totalUnserved;

            // Contractor matrix
            const matrixHtml = visibleCompanies.map(company => `
                <tr>
                    <td><strong>${company.name}</strong></td>
                    <td>${company.contractors.electrical || '‚Äî'}</td>
                    <td>${company.contractors.mechanical || '‚Äî'}</td>
                    <td>${company.contractors.interior_gc || '‚Äî'}</td>
                    <td>${company.contractors.marketing || '‚Äî'}</td>
                    <td>${company.contractors.staffing || '‚Äî'}</td>
                </tr>
            `).join('');
            document.getElementById('intel-matrix-body').innerHTML = matrixHtml || '<tr><td colspan="6" class="table-empty">No companies visible</td></tr>';

            // Location intelligence
            let allLocationIntel = [];
            visibleCompanies.forEach(company => {
                const unservedLocations = computeUnservedLocations(company.normalized);
                unservedLocations.forEach(location => {
                    allLocationIntel.push({ ...location, company_name: company.name });
                });
            });

            allLocationIntel.sort((a, b) => {
                const statusOrder = { 'Unserved': 0, 'Needs Intro': 1, 'Covered': 2 };
                return statusOrder[a.status] - statusOrder[b.status];
            });

            const locationsHtml = allLocationIntel.map(location => `
                <tr>
                    <td>${location.company_name}</td>
                    <td>${location.name}</td>
                    <td>${location.city}, ${location.state}</td>
                    <td>${location.contact}</td>
                    <td>${location.last_contacted}</td>
                    <td><span class="badge badge-${location.status.toLowerCase().replace(' ', '-')}">${location.status}</span></td>
                </tr>
            `).join('');
            document.getElementById('intel-locations-body').innerHTML = locationsHtml || '<tr><td colspan="6" class="table-empty">No locations found</td></tr>';

            // Change log
            const filteredLog = currentOrg === 'Triumph Atlantic' ? 
                mockData.changeLog : 
                mockData.changeLog.filter(log => log.org === currentOrg);

            const changeLogHtml = filteredLog.map(log => {
                const date = new Date(log.timestamp);
                return `
                    <tr>
                        <td>${date.toLocaleString()}</td>
                        <td>${log.user}</td>
                        <td><strong>${log.action}</strong></td>
                        <td>${log.details}</td>
                    </tr>
                `;
            }).join('');
            document.getElementById('change-log-body').innerHTML = changeLogHtml || '<tr><td colspan="4" class="table-empty">No activity recorded</td></tr>';
        }

        // Companies
        function updateCompanies() {
            const visibleCompanies = mockData.companies.filter(c => companyVisibleToOrg(c, currentOrg));
            
            const companiesHtml = visibleCompanies.map(company => {
                const locations = mockData.locations.filter(l => l.company === company.normalized).length;
                const contacts = mockData.contacts.filter(c => c.company === company.normalized).length;
                
                return `
                    <tr>
                        <td><strong>${company.name}</strong></td>
                        <td>${company.tier}</td>
                        <td>${company.status}</td>
                        <td>${company.hq_state}</td>
                        <td>${locations}</td>
                        <td>${contacts}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('companies-table-body').innerHTML = companiesHtml || '<tr><td colspan="6" class="table-empty">No companies found</td></tr>';
        }

        // Contacts
        function updateContacts() {
            const visibleContacts = mockData.contacts.filter(contact => {
                const company = mockData.companies.find(c => c.normalized === contact.company);
                return company && companyVisibleToOrg(company, currentOrg);
            });

            const contactsHtml = visibleContacts.map(contact => {
                const company = mockData.companies.find(c => c.normalized === contact.company);
                const nextDue = calculateNextTouchDue(contact.last_contacted, contact.cadence);
                const overdue = isOverdue(nextDue);
                
                const lastGift = contact.last_gift ? formatDate(contact.last_gift) : 'No gift given';
                
                return `
                    <tr class="${overdue ? 'overdue' : ''}">
                        <td><strong>${contact.first} ${contact.last}</strong></td>
                        <td>${contact.title}</td>
                        <td>${company ? company.name : contact.company}</td>
                        <td>${contact.location}</td>
                        <td>${contact.channel}</td>
                        <td>${formatDate(contact.last_contacted)}</td>
                        <td>${formatDate(nextDue)}</td>
                        <td>${lastGift}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('contacts-table-body').innerHTML = contactsHtml || '<tr><td colspan="8" class="table-empty">No contacts found</td></tr>';
        }

        // Referrals
        function updateReferrals() {
            const referralsHtml = mockData.referrals.map(ref => `
                <tr>
                    <td><strong>${ref.referred_name}</strong></td>
                    <td>${ref.company}</td>
                    <td>${ref.referrer_email.split('@')[0]}</td>
                    <td>${formatDate(ref.followup_date)}</td>
                    <td>${ref.status}</td>
                </tr>
            `).join('');
            
            document.getElementById('referrals-table-body').innerHTML = referralsHtml || '<tr><td colspan="5" class="table-empty">No referrals found</td></tr>';
        }

        // Opportunities
        function updateOpportunities() {
            const visibleCompanies = mockData.companies.filter(c => companyVisibleToOrg(c, currentOrg));
            const visibleOpps = mockData.opportunities.filter(opp => {
                return visibleCompanies.some(c => c.name === opp.company);
            });

            const oppsHtml = visibleOpps.map(opp => `
                <tr>
                    <td><strong>${opp.company}</strong></td>
                    <td>${opp.location}</td>
                    <td>${opp.job}</td>
                    <td>${opp.contact}</td>
                    <td>${formatDate(opp.start)}</td>
                    <td>${opp.valuation}</td>
                </tr>
            `).join('');
            
            document.getElementById('opportunities-table-body').innerHTML = oppsHtml || '<tr><td colspan="6" class="table-empty">No opportunities found</td></tr>';
        }

        // Projects
        function updateProjects() {
            const visibleCompanies = mockData.companies.filter(c => companyVisibleToOrg(c, currentOrg));
            const visibleProjects = mockData.projects.filter(proj => {
                return visibleCompanies.some(c => c.name === proj.company);
            });

            const projectsHtml = visibleProjects.map(proj => `
                <tr>
                    <td><strong>${proj.company}</strong></td>
                    <td>${proj.location}</td>
                    <td>${proj.job}</td>
                    <td>${proj.contact}</td>
                    <td>${formatDate(proj.start)}</td>
                    <td>${formatDate(proj.end)}</td>
                    <td>${proj.valuation}</td>
                </tr>
            `).join('');
            
            document.getElementById('projects-table-body').innerHTML = projectsHtml || '<tr><td colspan="7" class="table-empty">No projects found</td></tr>';
        }

        // Toast notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            document.getElementById('toast-container').appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });
    </script>
</body>
</html>
